<mvc:View
    controllerName="sap.cap.ai.chat.controller.App"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:l="sap.ui.layout"
    xmlns:core="sap.ui.core"
    height="100%"
>
    <App id="chatApp">
        <Page
            showHeader="true"
            enableScrolling="false"
            class="sapUiNoContentPadding"
            id="chatApp-page"
        >
            <customHeader>
                <Bar id="chatApp-page-bar">
                    <contentLeft>
                        <Title id="chatApp-page-title"
                            text="OpenCAP AI Chat Studio"
                            class="sapUiSmallMarginBegin"
                        />
                    </contentLeft>
                    <contentRight>
                        <Button
                        id="chatApp-page-button-new"
                            icon="sap-icon://add"
                            text="New Chat"
                            press=".onNewChat"
                        />
                        <Button
                        id="chatApp-page-button-setting"
                            icon="sap-icon://settings"
                            press=".onOpenSettings"
                        />
                        <Avatar
                        id="chatApp-page-button-avatar"
                            initials="{= ${ui>/userInfo/name} ? ${ui>/userInfo/name}.substring(0, 2).toUpperCase() : '??' }"
                            backgroundColor="Accent6"
                            class="sapUiSmallMarginEnd"
                            displaySize="S"
                            press=".onAvatarPress"
                        />
                    </contentRight>
                </Bar>
            </customHeader>
            <content>
                <l:Splitter height="100%" id="chatApp-page-button-spiltter">
                    <List
                        id="conversationList"
                        headerText="Conversations"
                        mode="SingleSelectMaster"
                        selectionChange=".onConversationSelect"
                        items="{
                            path: '/Conversations',
                            sorter: { path: 'modifiedAt', descending: true }
                        }"
                    >
                        <layoutData>
                            <l:SplitterLayoutData size="25%" id="chatApp-page-button-splitter-layout" />
                        </layoutData>
                        <items>
                            <CustomListItem type="Active" id="chatApp-page-button-custome-line">
                                <HBox id="chatApp-page-button-hbox"
                                    alignItems="Center"
                                    justifyContent="SpaceBetween"
                                    class="sapUiSmallMargin"
                                >
                                    <VBox id="_IDGenVBox1">
                                        <Title id="_IDGenTitle" text="{title}" />
                                        <Text id="_IDGenText"
                                            text="{model}"
                                            class="italicText"
                                        />
                                    </VBox>
                                    <HBox id="_IDGenHBox">
                                        <Button id="_IDGenButton"
                                            icon="sap-icon://edit"
                                            type="Transparent"
                                            press=".onEditTitle"
                                        />
                                        <Button id="_IDGenButton1"
                                            icon="sap-icon://delete"
                                            type="Transparent"
                                            press=".onDeleteConversation"
                                        />
                                    </HBox>
                                </HBox>
                            </CustomListItem>
                        </items>
                    </List>
                    <Page id="chatPage" showHeader="false" showFooter="true">
                        <layoutData>
                            <l:SplitterLayoutData id="_IDGenSplitterLayoutData" size="75%" />
                        </layoutData>
                        <content>
                            <ScrollContainer
                                id="scrollContainer"
                                height="100%"
                                width="100%"
                                vertical="true"
                                horizontal="false"
                            >
                                <VBox id="_IDGenVBox2">
                                    <List
                                        id="messageList"
                                        showSeparators="None"
                                        noDataText="No messages yet. Start a conversation!"
                                        class="sapUiSmallMarginTop"
                                    >
                                    </List>
                                    <HBox id="_IDGenHBox1"
                                        visible="{ui>/isStreaming}"
                                        class="sapUiSmallMargin"
                                    >
                                        <VBox id="_IDGenVBox3"
                                            class="chatBubble assistantBubble streamingBubble"
                                        >
                                            <HBox id="_IDGenHBox2"
                                                justifyContent="SpaceBetween"
                                                alignItems="Center"
                                                width="100%"
                                            >
                                                <Label id="_IDGenLabel"
                                                    text="assistant"
                                                    design="Bold"
                                                />
                                                <Button id="_IDGenButton2"
                                                    icon="sap-icon://stop"
                                                    type="Transparent"
                                                    press=".onStopStreaming"
                                                />
                                            </HBox>
                                            <FormattedText id="_IDGenText1"
                                                htmlText="{ui>/streamingText}"
                                            />
                                            <HBox id="_IDGenHBox3"
                                                alignItems="Center"
                                                class="sapUiTinyMarginTop"
                                                visible="{= ${ui>/streamingText} === '' }"
                                            >
                                                <BusyIndicator id="_IDGenBusyIndicator"
                                                    class="sapUiTinyMarginEnd"
                                                />
                                                <FormattedText id="_IDGenFormattedText"
                                                    htmlText="&lt;i&gt;AI is thinking...&lt;/i&gt;"
                                                />
                                            </HBox>
                                        </VBox>
                                    </HBox>
                                </VBox>
                            </ScrollContainer>
                        </content>
                        <footer>
                            <Toolbar id="_IDGenToolbar"
                                height="auto"
                                class="sapUiTinyMarginTopBottom"
                            >
                                <Button
                                    id="modelSelectButton"
                                    text="No model"
                                    press=".onSelectModel"
                                    type="Transparent"
                                />
                                <TextArea
                                    id="chatInput"
                                    rows="1"
                                    width="100%"
                                    placeholder="Type your message here..."
                                    growing="true"
                                    growingMaxLines="5"
                                />
                                <Button
                                    id="sendButton"
                                    enabled="{= !${ui>/isStreaming} }"
                                    icon="sap-icon://paper-plane"
                                    type="Emphasized"
                                    press=".onSendMessage"
                                />
                            </Toolbar>
                        </footer>
                    </Page>
                </l:Splitter>
            </content>
        </Page>
    </App>
</mvc:View>
